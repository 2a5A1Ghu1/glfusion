var imageTag=false;var theSelection=false;var clientPC=navigator.userAgent.toLowerCase();var clientVer=parseInt(navigator.appVersion);var is_ie=((clientPC.indexOf("msie")!=-1)&&(clientPC.indexOf("opera")==-1));var is_win=((clientPC.indexOf("win")!=-1)||(clientPC.indexOf("16bit")!=-1));var baseHeight;function bbstyle(a){if(a!=-1){bbfontstyle(bbtags[a],bbtags[a+1])}else{insert_text("[*]");document.forms[form_name].elements[text_name].focus()}}function bbfontstyle(b,f){theSelection=false;var d=document.forms[form_name].elements[text_name];d.focus();if((clientVer>=4)&&is_ie&&is_win){theSelection=document.selection.createRange().text;if(theSelection){document.selection.createRange().text=b+theSelection+f;document.forms[form_name].elements[text_name].focus();theSelection="";return}}else{if(document.forms[form_name].elements[text_name].selectionEnd&&(document.forms[form_name].elements[text_name].selectionEnd-document.forms[form_name].elements[text_name].selectionStart>0)){mozWrap(document.forms[form_name].elements[text_name],b,f);document.forms[form_name].elements[text_name].focus();theSelection="";return}}var a=getCaretPosition(d).start;var c=a+b.length;insert_text(b+f);if(!isNaN(d.selectionStart)){d.selectionStart=c;d.selectionEnd=c}else{if(document.selection){var e=d.createTextRange();e.move("character",c);e.select();storeCaret(d)}}d.focus();return}function insert_text(g,d,c){var b;if(!c){b=document.forms[form_name].elements[text_name]}else{b=opener.document.forms[form_name].elements[text_name]}if(d){g=" "+g+" "}if(!isNaN(b.selectionStart)){var f=b.selectionStart;var e=b.selectionEnd;mozWrap(b,g,"");b.selectionStart=f+g.length;b.selectionEnd=e+g.length}else{if(b.createTextRange&&b.caretPos){if(baseHeight!=b.caretPos.boundingHeight){b.focus();storeCaret(b)}var a=b.caretPos;a.text=a.text.charAt(a.text.length-1)==" "?a.text+g+" ":a.text+g}else{b.value=b.value+g}}if(!c){b.focus()}}function mozWrap(g,d,j){var c=g.textLength;var a=g.selectionStart;var e=g.selectionEnd;var b=g.scrollTop;if(e==1||e==2){e=c}var i=(g.value).substring(0,a);var h=(g.value).substring(a,e);var f=(g.value).substring(e,c);g.value=i+d+h+j+f;g.selectionStart=e+d.length+j.length;g.selectionEnd=g.selectionStart;g.focus();g.scrollTop=b;return}function storeCaret(a){if(a.createTextRange){a.caretPos=document.selection.createRange().duplicate()}}function caretPosition(){var b=null;var a=null}function getCaretPosition(e){var c=new caretPosition();if(e.selectionStart||e.selectionStart==0){c.start=e.selectionStart;c.end=e.selectionEnd}else{if(document.selection){var a=document.selection.createRange();var b=document.body.createTextRange();b.moveToElementText(e);var d;for(d=0;b.compareEndPoints("StartToStart",a)<0;d++){b.moveStart("character",1)}e.sel_start=d;c.start=e.sel_start;c.end=e.sel_start}}return c};