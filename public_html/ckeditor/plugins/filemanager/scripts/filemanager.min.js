!function(e){function t(e){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t)throw new Error("XMLHttpRequest not supported");return t.open("HEAD",e,!1),t.send(null),200==t.status?!0:!1}function a(t,i){return"dir"==t["File Type"]&&"replace"==i?!1:"dir"==t["File Type"]&&"download"==i?1==l.security.allowFolderDownload?!0:!1:"undefined"==typeof t.Capabilities?!0:e.inArray(i,t.Capabilities)>-1}function o(t){var i=t.attr("class").replace(/ /g,"_");if(""==i)return"itemOptions";if(!e("#"+i).length){var a=e("#itemOptions").clone().attr("id",i);t.hasClass("cap_select")||e(".select",a).remove(),t.hasClass("cap_download")||e(".download",a).remove(),t.hasClass("cap_rename")||e(".rename",a).remove(),t.hasClass("cap_move")||e(".move",a).remove(),e(".replace",a).remove(),t.hasClass("cap_delete")||e(".delete",a).remove(),e("#itemOptions").after(a)}return i}e.urlParam=function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return t?t[1]:0};var n=function(t){var i=null;t="undefined"==typeof t?"user":t;var a="./scripts/filemanager.config.php";return e.ajax({async:!1,url:a,dataType:"json",cache:!1,success:function(e){i=e}}),i},r=n("default"),l=n(),l=e.extend({},r,l);if(l.options.logger)var d=(new Date).getTime();HEAD_included_files=new Array,loadCSS=function(t){if(-1==e.inArray(t,HEAD_included_files)){var i=e("<link rel='stylesheet' type='text/css' href='"+t+"'>");e("head").append(i),HEAD_included_files.push(t)}},loadJS=function(t){if(-1==e.inArray(t,HEAD_included_files)){var i=e("<script type='text/javascript' src='"+t+"'>");e("head").append(i),HEAD_included_files.push(t)}},smartPath=function(e,t){var i=e.split("/"),a="/"+i[i.length-2]+"/",o=t.indexOf(a);return rvalue=-1==o?e+t:e+t.substring(o+a.length),l.options.logger&&console.log("url : "+e+" - path : "+t+" - separator : "+a+" -  pos : "+o+" - returned value : "+rvalue),rvalue};var s=l.options.fileConnector||"connectors/"+l.options.lang+"/filemanager."+l.options.lang,p=l.options.capabilities||new Array("select","download","rename","move","delete","replace");0!=e.urlParam("langCode")&&t("scripts/languages/"+e.urlParam("langCode")+".js")&&(l.options.culture=e.urlParam("langCode"));var c=[];e.ajax({url:"scripts/languages/"+l.options.culture+".js",async:!1,dataType:"json",success:function(e){c=e}}),e.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:!1});var f=function(){var t=53;e.urlParam("CKEditorCleanUpFuncNum")&&(t+=60);var i=e(window).height()-e("#uploader").height()-t;e("#splitter, #filetree, #fileinfo, .vsplitbar").height(i);var a=e("#splitter").width()-e("div.vsplitbar").width()-e("#filetree").width();e("#fileinfo").width(a)},u=function(e,t){if(t="undefined"==typeof t?!0:!1,0==l.options.showFullPath){if("function"==typeof displayPathDecorator)return displayPathDecorator(e.replace(fileRoot,"/"));if(e=e.replace(fileRoot,"/"),e.length>50&&t===!0){var i=e.split("/");e="/"+i[1]+"/"+i[2]+"/(...)/"+i[i.length-2]+"/"}return e}return e},m=function(t){"grid"==t?(e("#grid").addClass("ON"),e("#list").removeClass("ON")):(e("#list").addClass("ON"),e("#grid").removeClass("ON"))},h=function(e,t,a){var o=String(a);for(i=0;i<e.length;i++){var n=RegExp(e[i],"g"),r=t[i];o=o.replace(n,r)}return o},v=function(e){var t="",i=new Array("Š","š","Ð","d","Ž","ž","C","c","C","c","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","O","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","o","ø","ù","ú","û","ü","ý","ý","þ","ÿ","R","r"," ","'","/"),a=new Array("S","s","D","d","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","u","y","y","b","y","R","r","_","_","");return t=h(i,a,e),l.options.chars_only_latin&&(t=t.replace(/[^_a-zA-Z0-9]/g,"")),t=t.replace(/[_]+/g,"_")},w=function(e){return filename="",-1!=e.lastIndexOf(".")?(filename=v(e.substr(0,e.lastIndexOf("."))),filename+="."+e.split(".").pop()):filename=v(e),filename},g=function(e){for(var t=parseFloat(e),i=parseFloat(1024),a=0,o=[c.bytes,c.kb,c.mb,c.gb];;){if(i>t)return t=Math.round(100*t)/100,t+o[a];t/=i,a+=1}},y=function(t){e("#fileinfo").html("<h1>"+t+"</h1>"),e("#newfile").attr("disabled","disabled"),e("#upload").attr("disabled","disabled"),e("#newfolder").attr("disabled","disabled")},b=function(t){var i=_(t);return""==i&&1==l.security.allowNoExtension?!0:"DISALLOW_ALL"==l.security.uploadPolicy&&-1!=e.inArray(i,l.security.uploadRestrictions)?!0:"ALLOW_ALL"==l.security.uploadPolicy&&-1==e.inArray(i,l.security.uploadRestrictions)?!0:!1},_=function(e){return 1==e.split(".").length?"":e.split(".").pop().toLowerCase()},P=function(e){return-1!=e.lastIndexOf(".")?e.substring(0,e.lastIndexOf(".")):e},x=function(t){return-1!=e.inArray(_(t),l.edit.editExt)?!0:!1},C=function(t){return-1!=e.inArray(_(t),l.videos.videosExt)?!0:!1},E=function(t){return-1!=e.inArray(_(t),l.audios.audiosExt)?!0:!1},S=function(t){var i="<video width="+l.videos.videosPlayerWidth+" height="+l.videos.videosPlayerHeight+' src="'+t.Path+'" controls="controls">';i+='<img src="'+t.Preview+'" />',i+="</video>",e("#fileinfo img").remove(),e("#fileinfo #preview #main-title").before(i)},k=function(t){var i='<audio src="'+t.Path+'" controls="controls">';i+='<img src="'+t.Preview+'" />',i+="</audio>",e("#fileinfo img").remove(),e("#fileinfo #preview #main-title").before(i)},F=function(t){e("#fileinfo").find("td:first-child").each(function(){var i=e(this).attr("data-path"),a=e("#filetree").find('a[data-path="'+i+'"]').parent();"undefined"!=typeof a.css("background-image")&&(e(this).css("background-image",a.css("background-image")),window.clearInterval(t))})},O=function(t){e("#currentpath").val(t),e("#uploader h1").text(c.current_folder+u(t)).attr("title",u(t,!1)).attr("data-path",t),e("#newfolder").unbind().click(function(){var t=c.default_foldername,i=c.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+t+'" />',a=function(i,a){if(1!=i)return!1;var o=a.children("#fname").val();if(""!=o){t=v(o);var n=new Date;e.getJSON(s+"?mode=addfolder&path="+e("#currentpath").val()+"&name="+t+"&time="+n.getMilliseconds(),function(t){0==t.Code?(W(t.Parent,t.Name),q(t.Parent),e("#filetree").find('a[data-path="'+t.Parent+'/"]').click().click()):e.prompt(t.Error)})}else e.prompt(c.no_foldername)},o={};o[c.create_folder]=!0,o[c.cancel]=!1,e.prompt(i,{callback:a,buttons:o})})},R=function(t){e("#fileinfo button").each(function(){0==e(this).find("span").length&&e(this).wrapInner("<span></span>")}),a(t,"select")?(e("#fileinfo").find("button#select").click(function(){I(t)}).show(),(window.opener||window.tinyMCEPopup)&&(e("#preview img").attr("title",c.select),e("#preview img").click(function(){I(t)}).css("cursor","pointer"))):e("#fileinfo").find("button#select").hide(),a(t,"rename")?e("#fileinfo").find("button#rename").click(function(){var i=L(t);i.length&&e("#fileinfo > h1").text(i)}).show():e("#fileinfo").find("button#rename").hide(),a(t,"move")?e("#fileinfo").find("button#move").click(function(){var i=z(t);i.length&&e("#fileinfo > h1").text(i)}).show():e("#fileinfo").find("button#move").hide(),a(t,"replace")?e("#fileinfo").find("button#replace").click(function(){D(t)}).show():e("#fileinfo").find("button#replace").hide(),a(t,"delete")?e("#fileinfo").find("button#delete").click(function(){M(t)&&e("#fileinfo").html("<h1>"+c.select_from_left+"</h1>")}).show():e("#fileinfo").find("button#delete").hide(),a(t,"download")?e("#fileinfo").find("button#download").click(function(){window.location=s+"?mode=download&path="+encodeURIComponent(t.Path)}).show():e("#fileinfo").find("button#download").hide()},A=function(){if(e("#filetree .mCSB_container").length>0)var t="#filetree .mCSB_container";else var t="#filetree";e(t).fileTree({root:fileRoot,datafunc:K,multiFolder:!1,folderCallback:function(e){q(e)},expandedFolder:fullexpandedFolder,after:function(){e("#filetree").find("li a").each(function(){e(this).contextMenu({menu:o(e(this))},function(t,i){var a=e(i).attr("data-path");J(t,a)})}),1==l.options.searchBox&&(e("#q").liveUpdate("#filetree ul").blur(),e("#search span.q-inactive").html(c.search),e("#search a.q-reset").attr("title",c.search_reset))}},function(e){B(e)})},I=function(t){if(l.options.baseUrl!==!1)var i=smartPath(baseUrl,t.Path.replace(fileRoot,""));else var i=t.Path;if(window.opener||window.tinyMCEPopup||e.urlParam("field_name")||e.urlParam("CKEditorCleanUpFuncNum")||e.urlParam("CKEditor")){if(window.tinyMCEPopup){var a=tinyMCEPopup.getWindowArg("window");return a.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=i,"undefined"!=typeof a.ImageDialog&&(a.ImageDialog.getImageData&&a.ImageDialog.getImageData(),a.ImageDialog.showPreviewImage&&a.ImageDialog.showPreviewImage(i)),void tinyMCEPopup.close()}if(e.urlParam("field_name"))parent.document.getElementById(e.urlParam("field_name")).value=i,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close();else if(e.urlParam("CKEditor"))window.opener?window.opener.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),i):(parent.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),i),parent.CKEDITOR.tools.callFunction(e.urlParam("CKEditorCleanUpFuncNum")));else if(""!=t.Properties.Width){var o=i,n=t.Properties.Width,r=t.Properties.Height;window.opener.SetUrl(o,n,r)}else window.opener.SetUrl(i);window.opener&&window.close()}else e.prompt(c.fck_select_integration)},L=function(t){var i="",a=l.security.allowChangeExtensions?t.Filename:P(t.Filename),o=c.new_filename+' : <input id="rname" name="rname" type="text" value="'+a+'" />',n=function(a,o){if(1!=a)return!1;if(rname=o.children("#rname").val(),""!=rname){var n=rname;if(!l.security.allowChangeExtensions){n=w(rname);var r=_(t.Filename);r.length>0&&(n=n+"."+r)}if("/"!=t.Path.charAt(t.Path.length-1)&&!b(n)){var d="<p>"+c.INVALID_FILE_TYPE+"</p>";return"DISALLOW_ALL"==l.security.uploadPolicy&&(d+="<p>"+c.ALLOWED_FILE_TYPE+l.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==l.security.uploadPolicy&&(d+="<p>"+c.DISALLOWED_FILE_TYPE+l.security.uploadRestrictions.join(", ")+".</p>"),e("#filepath").val(""),e.prompt(d),!1}var p=(t.Path,s+"?mode=rename&old="+t.Path+"&new="+n);e.ajax({type:"GET",url:p,dataType:"json",async:!1,success:function(a){if(0==a.Code){var o=a["New Path"],n=a["New Name"],r=a["Old Path"];N(r,o,n);var d=e("#preview h1").attr("title");"undefined"!=typeof d&&d==r&&e("#preview h1").text(n),"grid"==e("#fileinfo").data("view")?(e('#fileinfo img[data-path="'+r+'"]').parent().next("p").text(n),e('#fileinfo img[data-path="'+r+'"]').attr("data-path",o)):(e('#fileinfo td[data-path="'+r+'"]').text(n),e('#fileinfo td[data-path="'+r+'"]').attr("data-path",o)),e("#preview h1").html(n),t.Path=o,t.Filename=n,e("#fileinfo").find("button#rename, button#delete, button#download").unbind(),R(t),l.options.showConfirmation&&e.prompt(c.successful_rename)}else e.prompt(a.Error);i=a["New Name"]}})}},r={};return r[c.rename]=!0,r[c.cancel]=!1,e.prompt(o,{callback:n,buttons:r}),i},D=function(t){e("#fileR").bind("change",function(){e(this).closest("form#toolbar").submit()}),e("#toolbar").attr("action",s),e("#toolbar").attr("method","post"),e("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(i,a){var o=e("#fileR",a).val();if(""==o)return!1;if(_(o)!=t["File Type"])return e.prompt(c.ERROR_REPLACING_FILE+" ."+_(t.Filename)),!1;if(e("#replace").attr("disabled",!0),e("#upload span").addClass("loading").text(c.loading_data),"undefined"!=typeof FileReader&&"auto"!=typeof l.upload.fileSizeLimit){var n=e("#fileR",a).get(0).files[0].size;if(n>1024*l.upload.fileSizeLimit*1024)return e.prompt("<p>"+c.file_too_big+"</p><p>"+c.file_size_limit+l.upload.fileSizeLimit+" "+c.mb+".</p>"),e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(c.upload),!1}},error:function(){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(c.upload),e.prompt(c.ERROR_UPLOADING_FILE)},success:function(){var t=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(0==t.Code){var i=t.Path+"/"+t.Name;B(i),e("#preview").find("img").hide().fadeIn("slow"),e("ul.jqueryFileTree").find('li a[data-path="'+i+'"]').parent().hide().fadeIn("slow"),l.options.showConfirmation&&e.prompt(c.successful_replace)}else e.prompt(t.Error);e("#replace").removeAttr("disabled"),e("#upload span").removeClass("loading").text(c.upload)}}),e("#newfilepath").val(t.Path),e("#fileR").click()},z=function(t){var i="",a=c.move+' : <input id="rname" name="rname" type="text" value="" />';a+='<div class="prompt-info">'+c.help_move+"</div>";var o=function(a,o){if(1!=a)return!1;if(rname=o.children("#rname").val(),""!=rname){var n=rname,r=(t.Path,s+"?mode=move&old="+encodeURIComponent(t.Path)+"&new="+encodeURIComponent(n)+"&root="+encodeURIComponent(fileRoot));e.ajax({type:"GET",url:r,dataType:"json",async:!1,success:function(t){if(0==t.Code){var a=t["New Path"],o=t["New Name"];fullexpandedFolder=a,A(),q(a),l.options.showConfirmation&&e.prompt(c.successful_moved)}else e.prompt(t.Error);i=a+o}})}},n={};return n[c.move]=!0,n[c.cancel]=!1,e.prompt(a,{callback:o,buttons:n}),i},M=function(t){var i=!1,a=c.confirmation_delete,o=function(a){if(1!=a)return!1;var o=new Date,n=s+"?mode=delete&path="+encodeURIComponent(t.Path)+"&time="+o.getMilliseconds(),r=t.Path.split("/").reverse().slice(1).reverse().join("/")+"/";e.ajax({type:"GET",url:n,dataType:"json",async:!1,success:function(t){if(0==t.Code){U(t.Path);var a=t.Path.substring(0,t.Path.length-1);a=a.substr(0,a.lastIndexOf("/")+1),e("#uploader h1").text(c.current_folder+u(a)).attr("title",u(a,!1)).attr("data-path",a),i=!0,l.options.showConfirmation&&e.prompt(c.successful_delete),e("#filetree").find('a[data-path="'+r+'/"]').click().click()}else i=!1,e.prompt(t.Error)}})},n={};return n[c.yes]=!0,n[c.no]=!1,e.prompt(a,{callback:o,buttons:n}),i},j=function(t){return isEdited=!1,e("#fileinfo").find("div#tools").append(' <a id="edit-file" href="#" title="'+c.edit+'"><span>'+c.edit+"</span></a>"),e("#edit-file").click(function(){e(this).hide();var i=new Date,a=s+"?mode=editfile&path="+encodeURIComponent(t.Path)+"&time="+i.getMilliseconds();e.ajax({type:"GET",url:a,dataType:"json",async:!1,success:function(i){if(0==i.Code){var a='<form id="edit-form">';a+='<textarea id="edit-content" name="content">'+i.Content+"</textarea>",a+='<input type="hidden" name="mode" value="savefile" />',a+='<input type="hidden" name="path" value="'+t.Path+'" />',a+='<button id="edit-cancel" class="edition" type="button">'+c.quit_editor+"</button>",a+='<button id="edit-save" class="edition" type="button">'+c.save+"</button>",a+="</form>",e("#preview").find("img").hide(),e("#preview").prepend(a).hide().fadeIn(),e("#edit-cancel").click(function(){e("#preview").find("form#edit-form").hide(),e("#preview").find("img").fadeIn(),e("#edit-file").show()}),e("#edit-save").click(function(){var t=codeMirrorEditor.getValue();e("textarea#edit-content").val(t);var i=e("#edit-form").serializeArray();e.ajax({type:"POST",url:s,dataType:"json",data:i,async:!1,success:function(t){0==t.Code?(isEdited=!0,e.prompt(c.successful_edit)):(isEdited=!1,e.prompt(t.Error))}})}),codeMirrorEditor=instantiateCodeMirror(_(t.Path),l)}else isEdited=!1,e.prompt(i.Error),e(this).show()}})}),isEdited},T=function(t,i){var a=_(i),o=e("#filetree").find('a[data-path="'+t+'"]'),n=o.parent(),r='<li class="file ext_'+a+'"><a data-path="'+t+i+'" href="#" class="">'+i+"</a></li>";n.find("ul").size()?(n.find("ul").prepend(r),o.click().click()):(n=e("#filetree").find("ul.jqueryFileTree"),n.prepend(r),A()),q(t),l.options.showConfirmation&&e.prompt(c.successful_added_file)},N=function(t,i,a){var o=e("#filetree").find('a[data-path="'+t+'"]'),n=o.parent().parent().prev("a");o.attr("data-path",i).text(a),0==n.length?A():n.click().click()},U=function(t){if(e("#filetree").find('a[data-path="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()}),e("#uploader h1").attr("data-path")==t){var i=t.split("/"),a=i.slice(0,length-2).join("/")+"/";q(a)}"grid"==e("#fileinfo").data("view")?e('#contents img[data-path="'+t+'"]').parent().parent().fadeOut("slow",function(){e(this).remove()}):e("table#contents").find('td[data-path="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()}),e("#preview").length&&q(t.substr(0,t.lastIndexOf("/")+1))},W=function(t,i){var a='<li class="directory collapsed"><a data-path="'+t+i+'/" href="#">'+i+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>',n=e("#filetree").find('a[data-path="'+t+'"]');t!=fileRoot?n.next("ul").prepend(a).prev("a").click().click():(e("#filetree ul.jqueryFileTree").prepend(a),e("#filetree").find('li a[data-path="'+t+i+'/"]').attr("class","cap_rename cap_delete").click(function(){q(t+i+"/")}).each(function(){e(this).contextMenu({menu:o(e(this))},function(t,i){var a=e(i).attr("data-path");J(t,a)})})),l.options.showConfirmation&&e.prompt(c.successful_added_folder)},H=function(t){t.lastIndexOf("/")==t.length-1?(q(t),e("#filetree").find('a[data-path="'+t+'"]').click()):B(t)},J=function(t,i){var a=new Date;e.getJSON(s+"?mode=getinfo&path="+i+"&time="+a.getMilliseconds(),function(i){if("grid"==e("#fileinfo").data("view")){e("#fileinfo").find('img[data-path="'+i.Path+'"]').parent()}else{e("#fileinfo").find('td[data-path="'+i.Path+'"]').parent()}switch(t){case"select":I(i);break;case"download":window.location=s+"?mode=download&path="+i.Path+"&time="+a.getMilliseconds();break;case"rename":{L(i)}break;case"replace":D(i);break;case"move":{z(i)}break;case"delete":M(i)}})},B=function(t){var i=t.substr(0,t.lastIndexOf("/")+1);O(i);var a='<div id="preview"><img /><div id="main-title"><h1></h1><div id="tools"></div></div><dl></dl></div>';a+='<form id="toolbar">',a+='<button id="parentfolder">'+c.parentfolder+"</button>",-1!=e.inArray("select",p)&&(e.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||e.urlParam("field_name"))&&(a+='<button id="select" name="select" type="button" value="Select">'+c.select+"</button>"),-1!=e.inArray("download",p)&&(a+='<button id="download" name="download" type="button" value="Download">'+c.download+"</button>"),-1!=e.inArray("rename",p)&&1!=l.options.browseOnly&&(a+='<button id="rename" name="rename" type="button" value="Rename">'+c.rename+"</button>"),-1!=e.inArray("move",p)&&1!=l.options.browseOnly&&(a+='<button id="move" name="move" type="button" value="Move">'+c.move+"</button>"),-1!=e.inArray("delete",p)&&1!=l.options.browseOnly&&(a+='<button id="delete" name="delete" type="button" value="Delete">'+c.del+"</button>"),-1!=e.inArray("replace",p)&&1!=l.options.browseOnly&&(a+='<button id="replace" name="replace" type="button" value="Replace">'+c.replace+"</button>",a+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div>',a+='<input id="mode" name="mode" type="hidden" value="replace" /> ',a+='<input id="newfilepath" name="newfilepath" type="hidden" />'),a+="</form>",e("#fileinfo .mCSB_container").length>0?e("#fileinfo .mCSB_container").html(a):e("#fileinfo").html(a),e("#parentfolder").click(function(){q(i)});var o=new Date;e.getJSON(s+"?mode=getinfo&path="+encodeURIComponent(t)+"&time="+o.getMilliseconds(),function(i){if(0==i.Code){e("#fileinfo").find("h1").text(i.Filename).attr("title",t),e("#fileinfo").find("img").attr("src",i.Preview),C(i.Filename)&&1==l.videos.showVideoPlayer&&S(i),E(i.Filename)&&1==l.audios.showAudioPlayer&&k(i),x(i.Filename)&&1==l.edit.enabled&&0==i.Protected&&j(i);var a=new Date;if(l.options.baseUrl!==!1)var o=smartPath(baseUrl,i.Path.replace(fileRoot,""));else var o=i.Path;0==i.Protected&&(e("#fileinfo").find("div#tools").append(' <a id="copy-button" data-clipboard-text="'+o+'" title="'+c.copy_to_clipboard+'" href="#"><span>'+c.copy_to_clipboard+"</span></a>"),loadJS("./scripts/zeroclipboard/copy.js?d"+a.getMilliseconds()),e("#copy-button").click(function(){e("#fileinfo").find("div#tools").append('<span id="copied">'+c.copied+"</span>"),e("#copied").delay(500).fadeOut(1e3,function(){e(this).remove()})}));var n="";i.Properties.Width&&""!=i.Properties.Width&&(n+="<dt>"+c.dimensions+"</dt><dd>"+i.Properties.Width+"x"+i.Properties.Height+"</dd>"),i.Properties["Date Created"]&&""!=i.Properties["Date Created"]&&(n+="<dt>"+c.created+"</dt><dd>"+i.Properties["Date Created"]+"</dd>"),i.Properties["Date Modified"]&&""!=i.Properties["Date Modified"]&&(n+="<dt>"+c.modified+"</dt><dd>"+i.Properties["Date Modified"]+"</dd>"),(i.Properties.Size||0==parseInt(i.Properties.Size))&&(n+="<dt>"+c.size+"</dt><dd>"+g(i.Properties.Size)+"</dd>"),e("#fileinfo").find("dl").html(n),R(i)}else e.prompt(i.Error)})},q=function(t){O(t);var i='<img id="activity" src="themes/'+l.options.theme+'/images/wait30trans.gif" width="30" height="30" />';e("#fileinfo .mCSB_container").length>0?e("#fileinfo .mCSB_container").html(i):e("#fileinfo").html(i),e("#loading-wrap").fadeOut(800);var n=new Date,r=s+"?path="+encodeURIComponent(t)+"&mode=getfolder&showThumbs="+l.options.showThumbs+"&time="+n.getMilliseconds();e.urlParam("type")&&(r+="&type="+e.urlParam("type")),e.getJSON(r,function(t){var i="";if("-1"==t.Code)return void y(t.Error);if(f(),t){var n=0,r=0;if("grid"==e("#fileinfo").data("view")){i+='<ul id="contents" class="grid">';for(key in t){n++;var d=t[key].Properties,s="";for(cap in p)a(t[key],p[cap])&&(s+=" cap_"+p[cap]);var u=64,m=d.Width;m>1&&u>m&&(u=m),title=l.options.showTitleAttr?' title="'+t[key].Path+'"':"",i+='<li class="'+s+'"'+title+'"><div class="clip"><img src="'+t[key].Preview+'" width="'+u+'" alt="'+t[key].Path+'" data-path="'+t[key].Path+'" /></div><p>'+t[key].Filename+"</p>",d.Width&&""!=d.Width&&(i+='<span class="meta dimensions">'+d.Width+"x"+d.Height+"</span>"),d.Size&&""!=d.Size&&(i+='<span class="meta size">'+d.Size+"</span>"),d.Size&&""!=d.Size&&(r+=d.Size),d["Date Created"]&&""!=d["Date Created"]&&(i+='<span class="meta created">'+d["Date Created"]+"</span>"),d["Date Modified"]&&""!=d["Date Modified"]&&(i+='<span class="meta modified">'+d["Date Modified"]+"</span>"),i+="</li>"}i+="</ul>"}else{i+='<table id="contents" class="list">',i+='<thead><tr><th class="headerSortDown"><span>'+c.name+"</span></th><th><span>"+c.dimensions+"</span></th><th><span>"+c.size+"</span></th><th><span>"+c.modified+"</span></th></tr></thead>",i+="<tbody>";for(key in t){n++;var d=(t[key].Path,t[key].Properties),s="";title=l.options.showTitleAttr?' title="'+t[key].Path+'"':"";for(cap in p)a(t[key],p[cap])&&(s+=" cap_"+p[cap]);i+='<tr class="'+s+'">',i+='<td data-path="'+t[key].Path+'"'+title+'">'+t[key].Filename+"</td>",i+=d.Width&&""!=d.Width?"<td>"+d.Width+"x"+d.Height+"</td>":"<td></td>",d.Size&&""!=d.Size?(i+='<td><abbr title="'+d.Size+'">'+g(d.Size)+"</abbr></td>",r+=d.Size):i+="<td></td>",i+=d["Date Modified"]&&""!=d["Date Modified"]?"<td>"+d["Date Modified"]+"</td>":"<td></td>",i+="</tr>"}i+="</tbody>",i+="</table>"}}else i+="<h1>"+c.could_not_retrieve_folder+"</h1>";if(e("#fileinfo .mCSB_container").length>0?e("#fileinfo .mCSB_container").html(i):e("#fileinfo").html(i),e("#items-counter").text(n),e("#items-size").text(Math.round(r/1024/1024*100)/100),"grid"==e("#fileinfo").data("view"))e("#fileinfo").find("#contents li").click(function(){var t=e(this).find("img").attr("data-path");H(t)}).each(function(){e(this).contextMenu({menu:o(e(this))},function(t,i){var a=e(i).find("img").attr("data-path");J(t,a)})});else{e("#fileinfo tbody tr").click(function(){var t=e("td:first-child",this).attr("data-path");H(t)}).each(function(){e(this).contextMenu({menu:o(e(this))},function(t,i){var a=e("td:first-child",i).attr("data-path");J(t,a)})}),e("#fileinfo").find("table").tablesorter({textExtraction:function(t){return e(t).find("abbr").size()?e(t).find("abbr").attr("title"):t.innerHTML}});var h=setInterval(function(){F(h)},300)}})},K=function(t,i){var o=new Date,n=s+"?path="+encodeURIComponent(t)+"&mode=getfolder&showThumbs="+l.options.showThumbs+"&time="+o.getMilliseconds();e.urlParam("type")&&(n+="&type="+e.urlParam("type")),e.getJSON(n,function(e){var t="";if("-1"==e.Code)return void y(e.Error);if(e){t+='<ul class="jqueryFileTree" style="display: none;">';for(key in e){var o="";for(cap in p)a(e[key],p[cap])&&(o+=" cap_"+p[cap]);if("dir"==e[key]["File Type"]){var n=0==e[key].Protected?"":" directory-locked";t+='<li class="directory collapsed'+n+'"><a href="#" class="'+o+'" data-path="'+e[key].Path+'">'+e[key].Filename+"</a></li>"}else if(l.options.listFiles){var n=0==e[key].Protected?"":" file-locked";t+='<li class="file ext_'+e[key]["File Type"].toLowerCase()+n+'"><a href="#" class="'+o+'" data-path="'+e[key].Path+'">'+e[key].Filename+"</a></li>"}}t+="</ul>"}else t+="<h1>"+c.could_not_retrieve_folder+"</h1>";i(t)})};e(function(){if(l.extras.extra_js)for(var t=0;t<l.extras.extra_js.length;t++)e.ajax({url:l.extras.extra_js[t],dataType:"script",async:l.extras.extra_js_async});if(e("#link-to-project").attr("href",l.url).attr("target","_blank").attr("title",c.support_fm+" ["+c.version+" : "+l.version+"]"),e("div.version").html(l.version),loadCSS("./themes/"+l.options.theme+"/styles/filemanager.css"),e.ajax({url:"./themes/"+l.options.theme+"/styles/ie.css",async:!1,success:function(t){e("head").append(t)}}),loadJS("./scripts/zeroclipboard/dist/ZeroClipboard.js"),l.edit.enabled&&(loadCSS("./scripts/CodeMirror/lib/codemirror.css"),loadCSS("./scripts/CodeMirror/theme/"+l.edit.theme+".css"),loadJS("./scripts/CodeMirror/lib/codemirror.js"),loadJS("./scripts/CodeMirror/addon/selection/active-line.js"),loadJS("./scripts/CodeMirror/dynamic-mode.js")),l.options.fileRoot?(fileRoot=l.options.serverRoot?"/"+l.options.fileRoot:l.options.fileRoot,fileRoot=fileRoot.replace(/\/\//g,"/")):fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/",baseUrl=l.options.baseUrl===!1?window.location.protocol+"//"+window.location.host:l.options.baseUrl,0!=e.urlParam("exclusiveFolder")&&(fileRoot+=e.urlParam("exclusiveFolder"),"/"!=fileRoot.charAt(fileRoot.length-1)&&(fileRoot+="/"),fileRoot=fileRoot.replace(/\/\//g,"/")),0!=e.urlParam("expandedFolder")?(expandedFolder=e.urlParam("expandedFolder"),fullexpandedFolder=fileRoot+expandedFolder):(expandedFolder="",fullexpandedFolder=null),e("#folder-info").html('<span id="items-counter"></span> '+c.items+" - "+c.size+' : <span id="items-size"></span> '+c.mb),1==l.options.autoload&&(e("#upload").append(c.upload),e("#newfolder").append(c.new_folder),e("#grid").attr("title",c.grid_view),e("#list").attr("title",c.list_view),e("#fileinfo h1").append(c.select_from_left),e('#itemOptions a[href$="#select"]').append(c.select),e('#itemOptions a[href$="#download"]').append(c.download),e('#itemOptions a[href$="#rename"]').append(c.rename),e('#itemOptions a[href$="#move"]').append(c.move),e('#itemOptions a[href$="#replace"]').append(c.replace),e('#itemOptions a[href$="#delete"]').append(c.del)),e.urlParam("CKEditorCleanUpFuncNum")&&(e("body").append('<button id="close-btn" type="button">'+c.close+"</button>"),e("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(e.urlParam("CKEditorCleanUpFuncNum"))})),e("#browse").append("+"),e("#browse").attr("title",c.browse),e("#newfile").change(function(){e("#filepath").val(e(this).val().replace(/.+[\\\/]/,""))}),l.options.searchBox===!0?loadJS("./scripts/filemanager.liveSearch.min.js"):e("#search").remove(),e("button").wrapInner("<span></span>"),e("#fileinfo").data("view",l.options.defaultViewMode),m(l.options.defaultViewMode),e("#home").click(function(){var t=e("#fileinfo").data("view");e("#fileinfo").data("view",t),e("#filetree ul.jqueryFileTree > li.expanded > a").trigger("click"),q(fileRoot)}),e("#level-up").click(function(){var t=e("#uploader h1").attr("data-path");if(t!=fileRoot){parent=t.substring(0,t.slice(0,-1).lastIndexOf("/"))+"/";var i=e("#fileinfo").data("view");e("#fileinfo").data("view",i),e("#filetree").find('a[data-path="'+t+'"]').click(),q(parent)}}),e("#grid").click(function(){m("grid"),e("#fileinfo").data("view","grid"),q(e("#currentpath").val())}),e("#list").click(function(){m("list"),e("#fileinfo").data("view","list"),q(e("#currentpath").val())}),O(fileRoot),l.upload.multiple?(loadCSS("./scripts/dropzone/downloads/css/dropzone.css"),loadJS("./scripts/dropzone/downloads/dropzone.js"),Dropzone.autoDiscover=!1,e("#file-input-container").remove(),e("#upload").remove(),e("#newfolder").before('<button value="Upload" type="button" name="upload" id="upload" class="em"><span>'+c.upload+"</span></button> "),e("#upload").unbind().click(function(){var t='<div id="dropzone-container"><h2>'+c.current_folder+e("#uploader h1").attr("title")+'</h2><div id="multiple-uploads" class="dropzone"></div>';t+='<div id="total-progress"><div data-dz-uploadprogress="" style="width:0%;" class="progress-bar"></div></div>',t+='<div class="prompt-info">'+c.dz_dictMaxFilesExceeded.replace("%s",l.upload.number)+c.file_size_limit+l.upload.fileSizeLimit+" "+c.mb+".</div>",t+='<button id="process-upload">'+c.upload+"</button></div>",error_flag=!1;var i=e("#currentpath").val(),a="auto"!=l.upload.fileSizeLimit?l.upload.fileSizeLimit:256;if("DISALLOW_ALL"==l.security.uploadPolicy)var o="."+l.security.uploadRestrictions.join(",.");else var o=null;if("images"==e.urlParam("type").toString().toLowerCase()||l.upload.imagesOnly)var o="."+l.images.imagesExt.join(",.");var n={};n[c.close]=!1,e.prompt(t,{buttons:n}),e("div#multiple-uploads").dropzone({paramName:"newfile",url:s,maxFilesize:a,maxFiles:l.upload.number,addRemoveLinks:!0,parallelUploads:l.upload.number,dictCancelUpload:c.cancel,dictRemoveFile:c.del,dictMaxFilesExceeded:c.dz_dictMaxFilesExceeded.replace("%s",l.upload.number),dictDefaultMessage:c.dz_dictDefaultMessage,dictInvalidFileType:c.dz_dictInvalidFileType,dictFileTooBig:c.file_too_big+" "+c.file_size_limit+l.upload.fileSizeLimit+" "+c.mb,acceptedFiles:o,autoProcessQueue:!1,init:function(){var t=this;e("#process-upload").click(function(){t.processQueue()})},totaluploadprogress:function(t){e("#total-progress .progress-bar").css("width",t+"%")},sending:function(e,t,a){a.append("mode","add"),a.append("currentpath",i)},success:function(t,a){e("#uploadresponse").empty().html(a);var o=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());0==o.Code?this.removeFile(t):(q(i),e("#filetree").find('a[data-path="'+i+'"]').click(),e.prompt(o.Error),error_flag=!0)},complete:function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&(e("#total-progress .progress-bar").css("width","0%"),0===this.getRejectedFiles().length&&error_flag===!1&&setTimeout(function(){e.prompt.close()},800),q(i),i==fileRoot&&A(),e("#filetree").find('a[data-path="'+i+'"]').click().click(),l.options.showConfirmation&&e.prompt(c.successful_added_file))}})})):(e("#uploader").attr("action",s),e("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(t,i){if(""==e("#newfile",i).val())return!1;if(!b(e("#newfile",i).val())){var a="<p>"+c.INVALID_FILE_TYPE+"</p>";return"DISALLOW_ALL"==l.security.uploadPolicy&&(a+="<p>"+c.ALLOWED_FILE_TYPE+l.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==l.security.uploadPolicy&&(a+="<p>"+c.DISALLOWED_FILE_TYPE+l.security.uploadRestrictions.join(", ")+".</p>"),e("#filepath").val(""),e.prompt(a),!1}if(e("#upload").attr("disabled",!0),e("#upload span").addClass("loading").text(c.loading_data),"images"==e.urlParam("type").toString().toLowerCase()){var o=e("#newfile",i).val().toLowerCase().split("."),n=!1;for(key in l.images.imagesExt)l.images.imagesExt[key]==o[o.length-1]&&(n=!0);if(n===!1)return e.prompt(c.UPLOAD_IMAGES_ONLY),e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(c.upload),!1}if("undefined"!=typeof FileReader&&"auto"!=typeof l.upload.fileSizeLimit){var r=e("#newfile",i).get(0).files[0].size;
if(r>1024*l.upload.fileSizeLimit*1024)return e.prompt("<p>"+c.file_too_big+"</p><p>"+c.file_size_limit+l.upload.fileSizeLimit+" "+c.mb+".</p>"),e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(c.upload),!1}},error:function(){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(c.upload),e.prompt(c.ERROR_UPLOADING_FILE)},success:function(){var t=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());0==t.Code?(T(t.Path,t.Name),e("#filepath, #newfile").val(""),e.browser.msie&&e("#newfile").replaceWith(e("#newfile").clone(!0)),e("#filetree").find('a[data-path="'+t.Path+'/"]').click().click()):e.prompt(t.Error),e("#upload").removeAttr("disabled"),e("#upload span").removeClass("loading").text(c.upload),e("#filepath").val("")}})),l.customScrollbar.enabled){loadCSS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),loadJS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js");var i=void 0!=l.customScrollbar.theme?l.customScrollbar.theme:"inset-2-dark",a=void 0!=l.customScrollbar.button?l.customScrollbar.button:!0;e(window).load(function(){e("#filetree").append('<div style="height:3000px"></div>'),e("#filetree").mCustomScrollbar({theme:i,scrollButtons:{enable:a},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onInit:function(){A()}},axis:"yx"}),e("#fileinfo").mCustomScrollbar({theme:i,scrollButtons:{enable:a},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},axis:"y",alwaysShowScrollbar:1})})}else A();window.opener||window.tinyMCEPopup||e.urlParam("field_name")||e('#itemOptions a[href$="#select"]').remove(),1==l.options.browseOnly&&(e("#file-input-container").remove(),e("#upload").remove(),e("#newfolder").remove(),e("#toolbar").remove("#rename"),e(".contextMenu .rename").remove(),e(".contextMenu .move").remove(),e(".contextMenu .replace").remove(),e(".contextMenu .delete").remove()),f(),e(window).resize(f),e("#splitter").splitter({sizeLeft:200}),H(fileRoot+expandedFolder)});var $=document.documentElement;if($.setAttribute("data-useragent",navigator.userAgent),l.options.logger){var G=(new Date).getTime(),Y=G-d;console.log("Total execution time : "+Y+" ms")}e(window).load(function(){f()})}(jQuery);