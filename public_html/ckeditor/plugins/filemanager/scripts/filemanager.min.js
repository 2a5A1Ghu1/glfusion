/*
	MIT License
 @author		Jason Huck - Core Five Labs
 @author		Simon Georget <simon (at) linea21 (dot) com>
 @copyright	Authors
*/
(function(e){function c(e){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t){throw new Error("XMLHttpRequest not supported")}t.open("HEAD",e,false);t.send(null);if(t.status==200){return true}return false}function g(t,n){if(t["File Type"]=="dir"&&(n=="download"||n=="replace"))return false;if(typeof t["Capabilities"]=="undefined")return true;else return e.inArray(n,t["Capabilities"])>-1}function z(t){var n=t.attr("class").replace(/ /g,"_");if(n=="")return"itemOptions";if(!e("#"+n).length){var r=e("#itemOptions").clone().attr("id",n);if(!t.hasClass("cap_select"))e(".select",r).remove();if(!t.hasClass("cap_download"))e(".download",r).remove();if(!t.hasClass("cap_rename"))e(".rename",r).remove();if(!t.hasClass("cap_move"))e(".move",r).remove();e(".replace",r).remove();if(!t.hasClass("cap_delete"))e(".delete",r).remove();e("#itemOptions").after(r)}return n}e.urlParam=function(e){var t=(new RegExp("[\\?&]"+e+"=([^&#]*)")).exec(window.location.href);if(t)return t[1];else return 0};var t=function(t){var n=null;t=typeof t==="undefined"?"user":t;var r="./scripts/filemanager.config.php";e.ajax({async:false,url:r,dataType:"json",cache:false,success:function(e){n=e}});return n};var n=t("default");var r=t();var r=e.extend({},n,r);HEAD_included_files=new Array;loadCSS=function(t){if(e.inArray(t,HEAD_included_files)==-1){var n=e("<link rel='stylesheet' type='text/css' href='"+t+"'>");e("head").append(n);HEAD_included_files.push(t)}};loadJS=function(t){if(e.inArray(t,HEAD_included_files)==-1){var n=e("<script type='text/javascript' src='"+t+"'>");e("head").append(n);HEAD_included_files.push(t)}};var s=r.options.fileConnector||"connectors/"+r.options.lang+"/filemanager."+r.options.lang;var o=r.options.capabilities||new Array("select","download","rename","move","delete","replace");if(e.urlParam("langCode")!=0&&c("scripts/languages/"+e.urlParam("langCode")+".js"))r.options.culture=e.urlParam("langCode");var u=[];e.ajax({url:"scripts/languages/"+r.options.culture+".js",async:false,dataType:"json",success:function(e){u=e}});e.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:false});var a=function(){var t=20;if(r.options.searchBox===true)t+=33;var n=e(window).height()-e("#uploader").height()-t;e("#splitter, #filetree, #fileinfo, .vsplitbar").height(n);var i=e("#splitter").width()-6-e("#filetree").width();e("#fileinfo").width(i)};var f=function(e,t){t=typeof t==="undefined"?true:false;if(r.options.showFullPath==false){if("function"===typeof displayPathDecorator){return displayPathDecorator(e.replace(fileRoot,"/"))}else{e=e.replace(fileRoot,"/");if(e.length>50&&t===true){var n=e.split("/");e="/"+n[1]+"/"+n[2]+"/(...)/"+n[n.length-2]+"/"}return e}}else{return e}};var l=function(t){if(t=="grid"){e("#grid").addClass("ON");e("#list").removeClass("ON")}else{e("#list").addClass("ON");e("#grid").removeClass("ON")}};var h=function(e,t,n){var r=String(n);for(i=0;i<e.length;i++){var s=RegExp(e[i],"g");var o=t[i];r=r.replace(s,o)}return r};var p=function(e){var t="";var n=new Array("Š","š","Đ","đ","Ž","ž","Č","č","Ć","ć","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","Ő","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ő","ø","ù","ú","û","ü","ý","ý","þ","ÿ","Ŕ","ŕ"," ","'","/");var i=new Array("S","s","Dj","dj","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","u","y","y","b","y","R","r","_","_","");t=h(n,i,e);if(r.options.chars_only_latin){t=t.replace(/[^_a-zA-Z0-9]/g,"")}t=t.replace(/[_]+/g,"_");return t};var d=function(e){filename="";if(e.lastIndexOf(".")!=-1){filename=p(e.substr(0,e.lastIndexOf(".")));filename+="."+e.split(".").pop()}else{filename=p(e)}return filename};var v=function(e){var t=parseFloat(e);var n=parseFloat(1024);var r=0;var i=[u.bytes,u.kb,u.mb,u.gb];while(true){if(t<n){t=Math.round(t*100)/100;return t+i[r]}else{t/=n;r+=1}}};var m=function(t){e("#fileinfo").html("<h1>"+t+"</h1>");e("#newfile").attr("disabled","disabled");e("#upload").attr("disabled","disabled");e("#newfolder").attr("disabled","disabled")};var y=function(t){if(r.security.uploadPolicy=="DISALLOW_ALL"){if(e.inArray(w(t),r.security.uploadRestrictions)!=-1)return true}if(r.security.uploadPolicy=="ALLOW_ALL"){if(e.inArray(w(t),r.security.uploadRestrictions)==-1)return true}return false};var b=function(e,t){var n=e.replace(/^.*[\/\\]/g,"");if(typeof t=="string"&&n.substr(n.length-t.length)==t){n=n.substr(0,n.length-t.length)}return n};var w=function(e){if(e.split(".").length==1){return""}return e.split(".").pop().toLowerCase()};var E=function(e){if(e.lastIndexOf(".")!=-1){return e.substring(0,e.lastIndexOf("."))}else{return e}};var S=function(t){if(e.inArray(w(t),r.edit.editExt)!=-1){return true}else{return false}};var x=function(t){if(e.inArray(w(t),r.images.imagesExt)!=-1){return true}else{return false}};var T=function(t){if(e.inArray(w(t),r.videos.videosExt)!=-1){return true}else{return false}};var N=function(t){if(e.inArray(w(t),r.audios.audiosExt)!=-1){return true}else{return false}};var C=function(t){var n="<video width="+r.videos.videosPlayerWidth+" height="+r.videos.videosPlayerHeight+' src="'+t["Path"]+'" controls="controls">';n+='<img src="'+t["Preview"]+'" />';n+="</video>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(n)};var k=function(t){var n='<audio src="'+t["Path"]+'" controls="controls">';n+='<img src="'+t["Preview"]+'" />';n+="</audio>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(n)};var L=function(t){e("#fileinfo").find("td:first-child").each(function(){var n=e(this).attr("data-path");var r=e("#filetree").find('a[data-path="'+n+'"]').parent();if(typeof r.css("background-image")!=="undefined"){e(this).css("background-image",r.css("background-image"));window.clearInterval(t)}})};var A=function(t){e("#currentpath").val(t);e("#uploader h1").text(u.current_folder+f(t)).attr("title",f(t,false)).attr("data-path",t);e("#newfolder").unbind().click(function(){var t=u.default_foldername;var n=u.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+t+'" />';var r=function(n,r){if(n!=1)return false;var i=r.children("#fname").val();if(i!=""){t=p(i);var o=new Date;e.getJSON(s+"?mode=addfolder&path="+e("#currentpath").val()+"&name="+t+"&time="+o.getMilliseconds(),function(t){if(t["Code"]==0){R(t["Parent"],t["Name"]);V(t["Parent"]);e("#filetree").find('a[data-path="'+t["Parent"]+'/"]').click().click()}else{e.prompt(t["Error"])}})}else{e.prompt(u.no_foldername)}};var i={};i[u.create_folder]=true;i[u.cancel]=false;e.prompt(n,{callback:r,buttons:i})})};var O=function(t){e("#fileinfo button").each(function(t){if(e(this).find("span").length==0)e(this).wrapInner("<span></span>")});if(!g(t,"select")){e("#fileinfo").find("button#select").hide()}else{e("#fileinfo").find("button#select").click(function(){_(t)}).show();if(window.opener||window.tinyMCEPopup){e("#preview img").attr("title",u.select);e("#preview img").click(function(){_(t)}).css("cursor","pointer")}}if(!g(t,"rename")){e("#fileinfo").find("button#rename").hide()}else{e("#fileinfo").find("button#rename").click(function(){var n=D(t);if(n.length)e("#fileinfo > h1").text(n)}).show()}if(!g(t,"move")){e("#fileinfo").find("button#move").hide()}else{e("#fileinfo").find("button#move").click(function(){var n=H(t);if(n.length)e("#fileinfo > h1").text(n)}).show()}if(!g(t,"replace")){e("#fileinfo").find("button#replace").hide()}else{e("#fileinfo").find("button#replace").click(function(){P(t)}).show()}if(!g(t,"delete")){e("#fileinfo").find("button#delete").hide()}else{e("#fileinfo").find("button#delete").click(function(){if(B(t))e("#fileinfo").html("<h1>"+u.select_from_left+"</h1>")}).show()}if(!g(t,"download")){e("#fileinfo").find("button#download").hide()}else{e("#fileinfo").find("button#download").click(function(){window.location=s+"?mode=download&path="+encodeURIComponent(t["Path"])}).show()}};var M=function(){e("#filetree").fileTree({root:fileRoot,datafunc:$,multiFolder:false,folderCallback:function(e){V(e)},expandedFolder:fullexpandedFolder,after:function(t){e("#filetree").find("li a").each(function(){e(this).contextMenu({menu:z(e(this))},function(t,n,r){var i=e(n).attr("data-path");W(t,i)})});if(r.options.searchBox==true){e("#q").liveUpdate("#filetree ul").blur();e("#search span.q-inactive").html(u.search);e("#search a.q-reset").attr("title",u.search_reset)}}},function(e){X(e)})};var _=function(t){if(r.options.relPath!==false){var n=relPath+t["Path"].replace(fileRoot,"")}else{var n=relPath+t["Path"]}if(window.opener||window.tinyMCEPopup||e.urlParam("field_name")){if(window.tinyMCEPopup){var i=tinyMCEPopup.getWindowArg("window");i.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=n;if(typeof i.ImageDialog!="undefined"){if(i.ImageDialog.getImageData)i.ImageDialog.getImageData();if(i.ImageDialog.showPreviewImage)i.ImageDialog.showPreviewImage(n)}tinyMCEPopup.close();return}if(e.urlParam("field_name")){parent.document.getElementById(e.urlParam("field_name")).value=n;if(typeof parent.tinyMCE!=="undefined"){parent.tinyMCE.activeEditor.windowManager.close()}if(typeof parent.$.fn.colorbox!=="undefined"){parent.$.fn.colorbox.close()}}else if(e.urlParam("CKEditor")){window.opener.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),n)}else{if(t["Properties"]["Width"]!=""){var s=n;var o=t["Properties"]["Width"];var a=t["Properties"]["Height"];window.opener.SetUrl(s,o,a)}else{window.opener.SetUrl(n)}}window.close()}else{e.prompt(u.fck_select_integration)}};var D=function(t){var n="";var i=u.new_filename+' : <input id="rname" name="rname" type="text" value="'+E(t["Filename"])+'" />';var o=function(i,o){if(i!=1)return false;rname=o.children("#rname").val();if(rname!=""){var a=d(rname);var f=w(t["Filename"]);if(f.length>0){a=a+"."+f}var l=t["Path"];var c=s+"?mode=rename&old="+t["Path"]+"&new="+a;e.ajax({type:"GET",url:c,dataType:"json",async:false,success:function(i){if(i["Code"]==0){var s=i["New Path"];var o=i["New Name"];I(l,s,o);var a=e("#preview h1").attr("title");if(typeof a!="undefined"&&a==l){e("#preview h1").text(o)}if(e("#fileinfo").data("view")=="grid"){e('#fileinfo img[data-path="'+l+'"]').parent().next("p").text(o);e('#fileinfo img[data-path="'+l+'"]').attr("data-path",s)}else{e('#fileinfo td[data-path="'+l+'"]').text(o);e('#fileinfo td[data-path="'+l+'"]').attr("data-path",s)}e("#preview h1").html(o);t["Path"]=s;t["Filename"]=o;e("#fileinfo").find("button#rename, button#delete, button#download").unbind();O(t);if(r.options.showConfirmation)e.prompt(u.successful_rename)}else{e.prompt(i["Error"])}n=i["New Name"]}})}};var a={};a[u.rename]=true;a[u.cancel]=false;e.prompt(i,{callback:o,buttons:a});return n};var P=function(t){e("#fileR").bind("change",function(){e(this).closest("form#toolbar").submit()});e("#toolbar").attr("action",s);e("#toolbar").attr("method","post");e("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(n,i,s){var o=e("#fileR",i).val();if(o==""){return false}if(w(o)!=t["File Type"]){e.prompt(u.ERROR_REPLACING_FILE+" ."+w(t["Filename"]));return false}e("#replace").attr("disabled",true);e("#upload span").addClass("loading").text(u.loading_data);if(typeof FileReader!=="undefined"&&typeof r.upload.fileSizeLimit!="auto"){var a=e("#fileR",i).get(0).files[0].size;if(a>r.upload.fileSizeLimit*1024*1024){e.prompt("<p>"+u.file_too_big+"</p><p>"+u.file_size_limit+r.upload.fileSizeLimit+" "+u.mb+".</p>");e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(u.upload);return false}}},error:function(t,n,r){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(u.upload);e.prompt(u.ERROR_UPLOADING_FILE)},success:function(t){var n=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(n["Code"]==0){var i=n["Path"]+"/"+n["Name"];X(i);e("#preview").find("img").hide().fadeIn("slow");e("ul.jqueryFileTree").find('li a[data-path="'+i+'"]').parent().hide().fadeIn("slow");if(r.options.showConfirmation)e.prompt(u.successful_replace)}else{e.prompt(n["Error"])}e("#replace").removeAttr("disabled");e("#upload span").removeClass("loading").text(u.upload)}});e("#newfilepath").val(t["Path"]);e("#fileR").click()};var H=function(t){var n="";var i=u.move+' : <input id="rname" name="rname" type="text" value="" />';var o=function(i,o){if(i!=1)return false;rname=o.children("#rname").val();if(rname!=""){var a=rname;var f=t["Path"];var l=s+"?mode=move&old="+encodeURIComponent(t["Path"])+"&new="+encodeURIComponent(a)+"&root="+encodeURIComponent(fileRoot);e.ajax({type:"GET",url:l,dataType:"json",async:false,success:function(t){if(t["Code"]==0){var i=t["New Path"];var s=t["New Name"];fullexpandedFolder=i;M();V(i);if(r.options.showConfirmation)e.prompt(u.successful_moved)}else{e.prompt(t["Error"])}n=i+s}})}};var a={};a[u.move]=true;a[u.cancel]=false;e.prompt(i,{callback:o,buttons:a});return n};var B=function(t){var n=false;var i=u.confirmation_delete;var o=function(i,o){if(i!=1)return false;var a=new Date;var l=s+"?mode=delete&path="+encodeURIComponent(t["Path"])+"&time="+a.getMilliseconds(),c=t["Path"].split("/").reverse().slice(1).reverse().join("/")+"/";e.ajax({type:"GET",url:l,dataType:"json",async:false,success:function(t){if(t["Code"]==0){q(t["Path"]);var i=t["Path"].substring(0,t["Path"].length-1);i=i.substr(0,i.lastIndexOf("/")+1);e("#uploader h1").text(u.current_folder+f(i)).attr("title",f(i,false)).attr("data-path",i);n=true;if(r.options.showConfirmation)e.prompt(u.successful_delete);e("#filetree").find('a[data-path="'+c+'/"]').click().click()}else{n=false;e.prompt(t["Error"])}}})};var a={};a[u.yes]=true;a[u.no]=false;e.prompt(i,{callback:o,buttons:a});return n};var j=function(t){isEdited=false;e("#fileinfo").find("h1").append(' <a id="edit-file" href="#" title="'+u.edit+'"><span>'+u.edit+"</span></a>");e("#edit-file").click(function(){e(this).hide();var n=new Date;var i=s+"?mode=editfile&path="+encodeURIComponent(t["Path"])+"&time="+n.getMilliseconds();e.ajax({type:"GET",url:i,dataType:"json",async:false,success:function(n){if(n["Code"]==0){var i='<form id="edit-form">';i+='<textarea id="edit-content" name="content">'+n["Content"]+"</textarea>";i+='<input type="hidden" name="mode" value="savefile" />';i+='<input type="hidden" name="path" value="'+t["Path"]+'" />';i+='<button id="edit-cancel" class="edition" type="button">'+u.quit_editor+"</button>";i+='<button id="edit-save" class="edition" type="button">'+u.save+"</button>";i+="</form>";e("#preview").find("img").hide();e("#preview").prepend(i).hide().fadeIn();e("#edit-cancel").click(function(){e("#preview").find("form#edit-form").hide();e("#preview").find("img").fadeIn();e("#edit-file").show()});e("#edit-save").click(function(){var t=codeMirrorEditor.getValue();e("textarea#edit-content").val(t);var n=e("#edit-form").serializeArray();e.ajax({type:"POST",url:s,dataType:"json",data:n,async:false,success:function(t){if(t["Code"]==0){isEdited=true;e.prompt(u.successful_edit)}else{isEdited=false;e.prompt(t["Error"])}}})});codeMirrorEditor=instantiateCodeMirror(w(t["Path"]),r)}else{isEdited=false;e.prompt(n["Error"]);e(this).show()}}})});return isEdited};var F=function(t,n){var i=w(n);var s=e("#filetree").find('a[data-path="'+t+'"]');var o=s.parent();var a='<li class="file ext_'+i+'"><a data-path="'+t+n+'" href="#" class="">'+n+"</a></li>";if(!o.find("ul").size()){o=e("#filetree").find("ul.jqueryFileTree");o.prepend(a);M()}else{o.find("ul").prepend(a);s.click().click()}V(t);if(r.options.showConfirmation)e.prompt(u.successful_added_file)};var I=function(t,n,r){var i=e("#filetree").find('a[data-path="'+t+'"]');var s=i.parent().parent().prev("a");i.attr("data-path",n).text(r);if(s.length==0){M()}else{s.click().click()}};var q=function(t){e("#filetree").find('a[data-path="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()});if(e("#uploader h1").attr("data-path")==t){var n=t.split("/");var r=n.slice(0,length-2).join("/")+"/";V(r)}if(e("#fileinfo").data("view")=="grid"){e('#contents img[data-path="'+t+'"]').parent().parent().fadeOut("slow",function(){e(this).remove()})}else{e("table#contents").find('td[data-path="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()})}if(e("#preview").length){V(t.substr(0,t.lastIndexOf("/")+1))}};var R=function(t,n){var i='<li class="directory collapsed"><a data-path="'+t+n+'/" href="#">'+n+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>';var s=e("#filetree").find('a[data-path="'+t+'"]');if(t!=fileRoot){s.next("ul").prepend(i).prev("a").click().click()}else{e("#filetree > ul").prepend(i);e("#filetree").find('li a[data-path="'+t+n+'/"]').attr("class","cap_rename cap_delete").click(function(){V(t+n+"/")}).each(function(){e(this).contextMenu({menu:z(e(this))},function(t,n,r){var i=e(n).attr("data-path");W(t,i)})})}if(r.options.showConfirmation)e.prompt(u.successful_added_folder)};var U=function(t){if(t.lastIndexOf("/")==t.length-1){V(t);e("#filetree").find('a[data-path="'+t+'"]').click()}else{X(t)}};var W=function(t,n){var r=new Date;e.getJSON(s+"?mode=getinfo&path="+n+"&time="+r.getMilliseconds(),function(n){if(e("#fileinfo").data("view")=="grid"){var i=e("#fileinfo").find('img[data-path="'+n["Path"]+'"]').parent()}else{var i=e("#fileinfo").find('td[data-path="'+n["Path"]+'"]').parent()}switch(t){case"select":_(n);break;case"download":window.location=s+"?mode=download&path="+n["Path"]+"&time="+r.getMilliseconds();break;case"rename":var o=D(n);break;case"replace":P(n);break;case"move":var o=H(n);break;case"delete":B(n);break}})};var X=function(t){var n=t.substr(0,t.lastIndexOf("/")+1);A(n);var i='<div id="preview"><img /><h1></h1><dl></dl></div>';i+='<form id="toolbar">';i+='<button id="parentfolder">'+u.parentfolder+"</button>";if(e.inArray("select",o)!=-1&&(window.opener||window.tinyMCEPopup||e.urlParam("field_name")))i+='<button id="select" name="select" type="button" value="Select">'+u.select+"</button>";if(e.inArray("download",o)!=-1)i+='<button id="download" name="download" type="button" value="Download">'+u.download+"</button>";if(e.inArray("rename",o)!=-1&&r.options.browseOnly!=true)i+='<button id="rename" name="rename" type="button" value="Rename">'+u.rename+"</button>";if(e.inArray("move",o)!=-1&&r.options.browseOnly!=true)i+='<button id="move" name="move" type="button" value="Move">'+u.move+"</button>";if(e.inArray("delete",o)!=-1&&r.options.browseOnly!=true)i+='<button id="delete" name="delete" type="button" value="Delete">'+u.del+"</button>";if(e.inArray("replace",o)!=-1&&r.options.browseOnly!=true){i+='<button id="replace" name="replace" type="button" value="Replace">'+u.replace+"</button>";i+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div>';i+='<input id="mode" name="mode" type="hidden" value="replace" /> ';i+='<input id="newfilepath" name="newfilepath" type="hidden" />'}i+="</form>";e("#fileinfo").html(i);e("#parentfolder").click(function(){V(n)});var a=new Date;e.getJSON(s+"?mode=getinfo&path="+encodeURIComponent(t)+"&time="+a.getMilliseconds(),function(n){if(n["Code"]==0){e("#fileinfo").find("h1").text(n["Filename"]).attr("title",t);e("#fileinfo").find("img").attr("src",n["Preview"]);if(T(n["Filename"])&&r.videos.showVideoPlayer==true){C(n)}if(N(n["Filename"])&&r.audios.showAudioPlayer==true){k(n)}if(S(n["Filename"])&&r.edit.enabled==true){j(n)}var i="";if(n["Properties"]["Width"]&&n["Properties"]["Width"]!="")i+="<dt>"+u.dimensions+"</dt><dd>"+n["Properties"]["Width"]+"x"+n["Properties"]["Height"]+"</dd>";if(n["Properties"]["Date Created"]&&n["Properties"]["Date Created"]!="")i+="<dt>"+u.created+"</dt><dd>"+n["Properties"]["Date Created"]+"</dd>";if(n["Properties"]["Date Modified"]&&n["Properties"]["Date Modified"]!="")i+="<dt>"+u.modified+"</dt><dd>"+n["Properties"]["Date Modified"]+"</dd>";if(n["Properties"]["Size"]||parseInt(n["Properties"]["Size"])==0)i+="<dt>"+u.size+"</dt><dd>"+v(n["Properties"]["Size"])+"</dd>";e("#fileinfo").find("dl").html(i);O(n)}else{e.prompt(n["Error"])}})};var V=function(t){A(t);e("#fileinfo").html('<img id="activity" src="images/wait30trans.gif" width="30" height="30" />');var n=new Date;var i=s+"?path="+encodeURIComponent(t)+"&mode=getfolder&showThumbs="+r.options.showThumbs+"&time="+n.getMilliseconds();if(e.urlParam("type"))i+="&type="+e.urlParam("type");e.getJSON(i,function(t){var n="";if(t.Code=="-1"){m(t.Error);return}if(t){if(e("#fileinfo").data("view")=="grid"){n+='<ul id="contents" class="grid">';for(key in t){var i=t[key]["Properties"];var s="";for(cap in o){if(g(t[key],o[cap])){s+=" cap_"+o[cap]}}var a=64;var f=i["Width"];if(f>1&&f<a)a=f;r.options.showTitleAttr?title=' title="'+t[key]["Path"]+'"':title="";n+='<li class="'+s+'"'+title+'"><div class="clip"><img src="'+t[key]["Preview"]+'" width="'+a+'" alt="'+t[key]["Path"]+'" data-path="'+t[key]["Path"]+'" /></div><p>'+t[key]["Filename"]+"</p>";if(i["Width"]&&i["Width"]!="")n+='<span class="meta dimensions">'+i["Width"]+"x"+i["Height"]+"</span>";if(i["Size"]&&i["Size"]!="")n+='<span class="meta size">'+i["Size"]+"</span>";if(i["Date Created"]&&i["Date Created"]!="")n+='<span class="meta created">'+i["Date Created"]+"</span>";if(i["Date Modified"]&&i["Date Modified"]!="")n+='<span class="meta modified">'+i["Date Modified"]+"</span>";n+="</li>"}n+="</ul>"}else{n+='<table id="contents" class="list">';n+='<thead><tr><th class="headerSortDown"><span>'+u.name+"</span></th><th><span>"+u.dimensions+"</span></th><th><span>"+u.size+"</span></th><th><span>"+u.modified+"</span></th></tr></thead>";n+="<tbody>";for(key in t){var l=t[key]["Path"];var i=t[key]["Properties"];var s="";r.options.showTitleAttr?title=' title="'+t[key]["Path"]+'"':title="";for(cap in o){if(g(t[key],o[cap])){s+=" cap_"+o[cap]}}n+='<tr class="'+s+'">';n+='<td data-path="'+t[key]["Path"]+'"'+title+'">'+t[key]["Filename"]+"</td>";if(i["Width"]&&i["Width"]!=""){n+="<td>"+i["Width"]+"x"+i["Height"]+"</td>"}else{n+="<td></td>"}if(i["Size"]&&i["Size"]!=""){n+='<td><abbr title="'+i["Size"]+'">'+v(i["Size"])+"</abbr></td>"}else{n+="<td></td>"}if(i["Date Modified"]&&i["Date Modified"]!=""){n+="<td>"+i["Date Modified"]+"</td>"}else{n+="<td></td>"}n+="</tr>"}n+="</tbody>";n+="</table>"}}else{n+="<h1>"+u.could_not_retrieve_folder+"</h1>"}e("#fileinfo").html(n);if(e("#fileinfo").data("view")=="grid"){e("#fileinfo").find("#contents li").click(function(){var t=e(this).find("img").attr("data-path");U(t)}).each(function(){e(this).contextMenu({menu:z(e(this))},function(t,n,r){var i=e(n).find("img").attr("data-path");W(t,i)})})}else{e("#fileinfo tbody tr").click(function(){var t=e("td:first-child",this).attr("data-path");U(t)}).each(function(){e(this).contextMenu({menu:z(e(this))},function(t,n,r){var i=e("td:first-child",n).attr("data-path");W(t,i)})});e("#fileinfo").find("table").tablesorter({textExtraction:function(t){if(e(t).find("abbr").size()){return e(t).find("abbr").attr("title")}else{return t.innerHTML}}});var c=setInterval(function(){L(c)},300)}})};var $=function(t,n){var i=new Date;var a=s+"?path="+encodeURIComponent(t)+"&mode=getfolder&showThumbs="+r.options.showThumbs+"&time="+i.getMilliseconds();if(e.urlParam("type"))a+="&type="+e.urlParam("type");e.getJSON(a,function(e){var t="";if(e.Code=="-1"){m(e.Error);return}if(e){t+='<ul class="jqueryFileTree" style="display: none;">';for(key in e){var i="";for(cap in o){if(g(e[key],o[cap])){i+=" cap_"+o[cap]}}if(e[key]["File Type"]=="dir"){t+='<li class="directory collapsed"><a href="#" class="'+i+'" data-path="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}else{if(r.options.listFiles){t+='<li class="file ext_'+e[key]["File Type"].toLowerCase()+'"><a href="#" class="'+i+'" data-path="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}}}t+="</ul>"}else{t+="<h1>"+u.could_not_retrieve_folder+"</h1>"}n(t)})};e(function(){if(r.extras.extra_js){for(var t=0;t<r.extras.extra_js.length;t++){e.ajax({url:r.extras.extra_js[t],dataType:"script",async:r.extras.extra_js_async})}}if(r.edit.enabled){loadCSS("./scripts/CodeMirror/lib/codemirror.css");loadCSS("./scripts/CodeMirror/theme/"+r.edit.theme+".css");loadJS("./scripts/CodeMirror/lib/codemirror.js");loadJS("./scripts/CodeMirror/addon/selection/active-line.js");loadJS("./scripts/CodeMirror/dynamic-mode.js")}if(!r.options.fileRoot){fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/"}else{if(!r.options.serverRoot){fileRoot=r.options.fileRoot}else{fileRoot="/"+r.options.fileRoot}fileRoot=fileRoot.replace(/\/\//g,"/")}if(r.options.relPath===false){relPath=window.location.protocol+"//"+window.location.host}else{relPath=r.options.relPath}if(e.urlParam("exclusiveFolder")!=0){fileRoot+=e.urlParam("exclusiveFolder");if(fileRoot.charAt(fileRoot.length-1)!="/")fileRoot+="/";fileRoot=fileRoot.replace(/\/\//g,"/")}if(e.urlParam("expandedFolder")!=0){expandedFolder=e.urlParam("expandedFolder");fullexpandedFolder=fileRoot+expandedFolder}else{expandedFolder="";fullexpandedFolder=null}if(r.options.autoload==true){e("#upload").append(u.upload);e("#newfolder").append(u.new_folder);e("#grid").attr("title",u.grid_view);e("#list").attr("title",u.list_view);e("#fileinfo h1").append(u.select_from_left);e('#itemOptions a[href$="#select"]').append(u.select);e('#itemOptions a[href$="#download"]').append(u.download);e('#itemOptions a[href$="#rename"]').append(u.rename);e('#itemOptions a[href$="#move"]').append(u.move);e('#itemOptions a[href$="#replace"]').append(u.replace);e('#itemOptions a[href$="#delete"]').append(u.del)}e("#browse").append("+");e("#browse").attr("title",u.browse);e("#newfile").change(function(){e("#filepath").val(e(this).val().replace(/.+[\\\/]/,""))});if(r.options.searchBox===true){e.getScript("./scripts/filemanager.liveSearch.min.js")}else{e("#search").remove()}e("button").wrapInner("<span></span>");e("#fileinfo").data("view",r.options.defaultViewMode);l(r.options.defaultViewMode);e("#home").click(function(){var t=e("#fileinfo").data("view");e("#fileinfo").data("view",t);e("#filetree>ul>li.expanded>a").trigger("click");V(fileRoot)});e("#grid").click(function(){l("grid");e("#fileinfo").data("view","grid");V(e("#currentpath").val())});e("#list").click(function(){l("list");e("#fileinfo").data("view","list");V(e("#currentpath").val())});A(fileRoot);e("#uploader").attr("action",s);e("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(t,n,i){if(e("#newfile",n).val()==""){return false}if(!y(e("#newfile",n).val())){var s="<p>"+u.INVALID_FILE_TYPE+"</p>";if(r.security.uploadPolicy=="DISALLOW_ALL"){s+="<p>"+u.ALLOWED_FILE_TYPE+r.security.uploadRestrictions.join(", ")+".</p>"}if(r.security.uploadPolicy=="ALLOW_ALL"){s+="<p>"+u.DISALLOWED_FILE_TYPE+r.security.uploadRestrictions.join(", ")+".</p>"}e("#filepath").val("");e.prompt(s);return false}e("#upload").attr("disabled",true);e("#upload span").addClass("loading").text(u.loading_data);if(e.urlParam("type").toString().toLowerCase()=="images"){var o=e("#newfile",n).val().toLowerCase().split(".");for(key in r.images.imagesExt){if(r.images.imagesExt[key]==o[o.length-1]){return true}}e.prompt(u.UPLOAD_IMAGES_ONLY);e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(u.upload);return false}if(typeof FileReader!=="undefined"&&typeof r.upload.fileSizeLimit!="auto"){var a=e("#newfile",n).get(0).files[0].size;if(a>r.upload.fileSizeLimit*1024*1024){e.prompt("<p>"+u.file_too_big+"</p><p>"+u.file_size_limit+r.upload.fileSizeLimit+" "+u.mb+".</p>");e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(u.upload);return false}}},error:function(t,n,r){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(u.upload);e.prompt(u.ERROR_UPLOADING_FILE)},success:function(t){var n=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(n["Code"]==0){F(n["Path"],n["Name"]);e("#filepath, #newfile").val("");if(e.browser.msie)e("#newfile").replaceWith(e("#newfile").clone(true));e("#filetree").find('a[data-path="'+n["Path"]+'/"]').click().click()}else{e.prompt(n["Error"])}e("#upload").removeAttr("disabled");e("#upload span").removeClass("loading").text(u.upload);e("#filepath").val("")}});M();if(!(window.opener||window.tinyMCEPopup||e.urlParam("field_name")))e('#itemOptions a[href$="#select"]').remove();if(r.options.browseOnly==true){e("#file-input-container").remove();e("#upload").remove();e("#newfolder").remove();e("#toolbar").remove("#rename");e(".contextMenu .rename").remove();e(".contextMenu .move").remove();e(".contextMenu .replace").remove();e(".contextMenu .delete").remove()}a();e(window).resize(a);e("#splitter").splitter({sizeLeft:200});U(fileRoot+expandedFolder)});var J=document.documentElement;J.setAttribute("data-useragent",navigator.userAgent)})(jQuery)